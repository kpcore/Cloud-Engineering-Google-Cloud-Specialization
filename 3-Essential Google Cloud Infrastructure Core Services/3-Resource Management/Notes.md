## 1. Module Overview

* In this module, we will cover resource management. Resources and GCP are billable, so managing them means controlling cost. There are several methods in place for controlling access to the resources and there are quotas that limit consumption. In most cases, the default quotas can be raised on request. But having them in place provides a checkpoint or a chance to make sure that this really is a resource you intend to consume in greater quantity.
* In this module, we will build on what we learned in the Cloud IAM module. First, I will provide an overview of the resource manager. Then, we will go into quotas, labels and names. Next, we will cover billing to help you set budgets and alerts. To complete your learning experience, you will get to examine billing data with BigQuery in a lab.

## 2. Cloud Resource Manager

* The resource manager lets you hierarchically manage resources by project, folder, and organization. This should sound familiar because we covered it in the Cloud IAM module. Let me refresh your memory. 
* Policies contain a set of roles and members, and policies are set on resources. These resources inherit policies from their parent as we can see on the left. Therefore, resource policies are a union of parent and resource. Also, keep in mind that if a parent policy is less restrictive, it overrides the more restrictive resource policy. Although IAM policies are inherited top to bottom, billing is accumulated from the bottom up, as we can see on the right.
* Resource consumption is measured in quantities like rate of use or time, number of items, or feature use. Because a resource belongs to only one project, a project accumulates the consumption of all its resources. Each project is associated with one billing account, which means that an organization contains all billing accounts. Let's explore organizations, projects, and resources more. 
* Just to reiterate, an organization node is the root node for all Google Cloud Platform resources. This diagram shows an example where we have an individual Bob, who has control of the organizational domain through the organization admin role. Bob has delegated privileges and access to the individual projects to Alice by making her a project creator. Because a project accumulates the consumption of all its resources, it can be used to track resources and quota usage. Specifically, projects that you enable billing, manage permissions and credentials, and enabled service and APIs. 
* To interact with Cloud Platform resources, you must provide the identifying project information for every request. A project can be identified by the project name, which is a human-readable way to identify your projects, but it isn't used by any Google APIs. There's also the project number, which is automatically generated by the server and assigned to your project, and there is the Project ID, which is a unique ID that is generated from your project name. You can find these three identifying attributes on the dashboard of your GCP console, or by querying the Resource Manager API. 
* Finally, let's talk about the resource hierarchy. From a physical organization standpoint, resources are categorized as global, regional, or zonal. Let's look at some examples. Images, snapshots, and networks, are global resources. External IP addresses are regional resources, and instances and disks are zonal resources. However, regardless of the type, each resource is organized into a project. This enables each project to have its own billing and reporting.

## 3. Quotas

* Now that we know that a project accumulates the consumption of all its resources, let's talk about quotas. All resources and GCP are subject to project quotas or limits. These typically fall into one of the three categories shown here. 
* How many resources you can create per project? For example, you can only have five VPC networks for project. How quickly you can make API requests in a project or rate limits. For example, by default, you can only make five administrative actions per second per project when using the Cloud Spanner API. There are also regional quotas. For example, by default, you can only have 24 CPUs per region. Given these quotas, you may be wondering, how do I spin up one of those 96 core VMs?
* As your use of GCP expands over time, your quotas may increase accordingly. If you expect a notable upcoming increasing usage, you can proactively request quota adjustments from the quotas page in the GCP Console. 
* If quotas can be changed, why do they exist? Project quotas prevent runaway consumption in case of an error or malicious attack. For example, imagine you accidentally create a 100 instances instead of 10 Compute Engine instances using the gcloud command-line. Quotas also prevent billing spikes or surprises. Quotas are related to billing, but we will go through how to set up budgets and alerts later, which will really help you manage billing.
* Finally, quotas forces consideration and periodic review. For example, do you really need a 96 Core instance? Or can you go with a smaller and cheaper alternative? It is also important to mention the quotas are the maximum amount of resources you can create for that resource type as long as those resources are available.
* Quotas do not guarantee that resources will be available at all times. For example, if a region is out of local SSDs, you cannot create local SSDs in that region even if you still had quota for local SSDs.

## 4. Labels and Names

* Projects and folders provide levels of segregation for resources. But what if you want more granularity? That's where labels and names come in. Labels are a utility for organizing GCP resources.
* Labels are key value pairs that you can attach to your resources like VMs, disks, snapshots, and images. You can create and manage labels using the GCP Console, gcloud or the Resource Manager API, and each resource can have up to 64 labels. 
* For example, you could create a label to define the environment of your virtual machines. Then you define the label for each of your instances as either production or test. Using this label, you could search and list all of your production resources for inventory purposes. 
* Labels can also be used in scripts to help analyze costs or to run bulk operations on multiple resources. The screenshot on the right shows an example of four labels that are created on an instance. Let's go over some examples of what to use labels for.
* I recommend adding labels based on team or cost center to distinguish instances owned by different teams. You can use this type of label for cost accounting or budgeting. For example, team colon marketing and team colon research.
* You can also use labels to distinguish components. For example, component colon redis, component colon front end. Again, you can label based on environment or stage. You should also consider using labels to define an owner or a primary contact for a resource. For example, owner colon gaurav, contact colon OPM or add labels to your resources to define their state. For example, state colon in-use, state colon ready for deletion.
* Now it's important to not confuse labels with tags. Labels, we just learned, are user-defined strings in key-value format that are used to organize resources and they can propagate through billing. Tags, on the other hand, are user-defined strings that are applied to instances only and are mainly used for networking such as applying firewall rules.

## 5. Billing

* Because the consumption of all resources under a project accumulates into one billing account, let's talk billing. To help with project planning and controlling costs. You can set a budget. Setting a budget lets you track how your spend is growing towards that amount. 
* This screenshot shows the budget creation interface. First, you set a budget name and specify which project this budget applies to. Then you can set the budget at a specific amount or match it to the previous month spend. After you determine your budget amount, you can set the budget alerts. These alerts send emails to billing admins after spend exceeds a percentage of the budget or a specified amount. In our case, it would send an email when spending reaches 50 percent, 90 percent and a 100 percent of the budget amount.
* You can even choose to send an alert when the spend is forecasted to exceed the percent of the budget amount by the end of the budget period. In addition to receiving an email, you can use Cloud Pub Sub notifications to programmatically receive spend updates about this budget. You could even create a Cloud Function that listens to the Pub Sub topic to automate cost management. 
* Here's an example of an email notification. The email contains the project name, the percent of the budget that was exceeded, and the budget amount. Another way to help optimize your GCP spend is to used labels. 
* For example, you could label VM instances that are spread across different regions. Maybe these instances are sending most of their traffic to a different continent which could incur higher cost. In that case, you might consider relocating some of those instances or using a caching service like Cloud CDN to cach content closer to your users, which reduces your networking spend.
* I recommend labeling all your resources and exporting your billing data to BigQuery to analyze your spend. BigQuery is Google's scalable, bully managed enterprise data warehouse with SQL and fast response times. 
* Creating a query is as simple as shown in this screenshot, which you will explore in the upcoming lab. You can even visualize spend over time with Data studio. Data Studio turns your data into an formative dashboards and reports that are easy to read, easy to share, and fully customizable. For example, you can slice and dice your billing reports using your labels.

## QuizNotes

* How do quotas protect GCP customers?
	* By preventing uncontrolled consumption of resources.
		* Quotas are established at reasonable defaults for common cloud usage and proof of concept activities. If you are planning to scale up a production cloud solution you may need to request that the quotas be raised. This is a reasonable checkpoint to verify that actions that might result in a large consumption of resources are reviewed.
* A budget is set at $500 and an alert is set at 100%. What happens when the full amount is used?
	* A notification email is sent to the Billing Administrator.
		* Budgets in GCP are not a way to prevent spending or stop resources. They are a tool for raising awareness about the consumption of resources so that a business can implement its own consumption management processes.
* No resources in GCP can be used without being associated with...
	* A project.
		* All resources in GCP are tracked and their consumption is logged against a project. A project relates resources to a billing method.

## Resources

[Creating and Managing Labels](https://cloud.google.com/resource-manager/docs/creating-managing-labels)

[Programmatic Budgets Notification Examples](https://cloud.google.com/billing/docs/how-to/notify)